name: Release Workflow
on:
  push:
    branches:
      - main

permissions:
  contents: write # to be able to publish a GitHub release
  issues: write # to be able to comment on released issues
  pull-requests: write # to be able to comment on released pull requests
  id-token: write # to enable use of OIDC for npm provenance


jobs:
  release-please:
    name: version-changelog
    runs-on: ubuntu-latest
    # outputs:
    #   version: ${{ steps.step3.outputs.version }}
    steps:
      # 检出代码到工作目录，直接进入项目的一级目录
      - id: step1
        name: Checkout Repository
        uses: actions/checkout@v2

      - id: step2
        uses: google-github-actions/release-please-action@v3
        with:
          release-type: dart
          package-name: release-please-action
      # - run: |
      #     echo "cat version.txt"
      #     ls
      #     cat version.txt
      # - id: step3
      #   run: |
      #     sudo apt-get update -y && sudo apt-get install jq -y
      #     version=$(jq -r '.version' package.json)
      #     echo "version=${version}" >> $GITHUB_OUTPUT
  # handle-pubspec:
  #   needs: release-please
  #   name: handle-pubspec
  #   runs-on: ubuntu-latest
  #   steps:
  #     # 检出代码到工作目录，直接进入项目的一级目录
  #     - id: step1
  #       name: Checkout Repository
  #       uses: actions/checkout@v2

  #     - id: step2
  #       name: Update pubspec.yaml
  #       run: |
  #         ls
  #         pwd
  #         version=${{ needs.release-please.outputs.version }}
  #         sed -i "s/version: .*/version: ${version}/" pubspec.yaml
  #     - name: Commit and Push Changes
  #       run: |
  #         git config --global user.name "imagineboom"
  #         git config --global user.email "imagineboom@foxmail.com"
  #         git add pubspec.yaml
  #         git commit -m "build: update version in pubspec.yaml"
  #         git push